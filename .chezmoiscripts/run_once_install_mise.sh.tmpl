{{ if eq .chezmoi.os "linux" -}}
#!/bin/sh

set -eu

echo "RUN_ONCE_MISE_SCRIPT_RUNNING" >> /tmp/mise_log

if ! command -v mise >/dev/null 2>&1; then
  echo "[chezmoiscripts/run_once_install_mise.sh.tmpl] - Installing mise..."
  curl https://mise.run | sh || echo "Warning: mise installation failed" >> /tmp/mise_log
fi

export PATH="$HOME/.local/bin:$PATH"

echo "chezmoi walking HERE"

MISE_BIN="$(command -v mise || true)"
if [ -z "$MISE_BIN" ]; then
  echo "[chezmoi] mise install failed or not found"
  exit 0
fi

"$MISE_BIN" trust "$HOME/.config/mise/config.toml" || true
"$MISE_BIN" install --yes || true

{{ else if eq .chezmoi.os "darwin" -}}
#!/bin/sh
# No mise setup on macOS
exit 0
{{ end -}}
